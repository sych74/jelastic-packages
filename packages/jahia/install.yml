---
type: install
version: 1.5.2
name: Jahia - Install
logo: ../../assets/common/jahia-logo-70x70.png
id: jahia-jelastic
description:
  short: Jahia - Install
  text: Digital Experience Manager gives you an agile customizable platform that
    manages your entire digital ecosystem to innovate and deliver great customer
    experiences, foster internal collaboration and support dynamic business
    needs for sustainable growth.

success: ../../assets/jahia/success_install.md

globals:
  jahia_env_version: 6
  healthcheck_token: ${fn.password(20)}
  db_user: jahia-db-${fn.random}
  db_pass: ${fn.password(20)}
  db_user_datadog: ${fn.password(20)}
  mngr_user: manager
  dbnodeType: mariadb-dockerized
  xms: 256M
  xmx: 2584M

ssl: true
skipNodeEmails: true

mixins:
  - ../../mixins/common.yml
  - ../../mixins/mariadb.yml

onBeforeInstall: |
  nodes = []

  node_mariadb = {
    "nodeType": "${globals.dbnodeType}",
    "nodeGroup": "sqldb",
    "tag": "10.4.13",
    "count": 3,
    "cloudlets": 40,
    "isSLBAccessEnabled": false,
    "env": {
        "ADMINPANEL_ENABLED": false,
        "PHPMYADMIN_ENABLED": false,
        "DB_USER": "${globals.db_user}",
        "DB_PASS": "${globals.db_pass}",
        "_PROVIDE": "Database",
        "_ROLE": galera
      },
    "distribution": {
        "mode": "STRICT",
        "zones": [
            {high_iops: false}
        ]
      }
  }
  nodes.push(node_mariadb);
  var resp = {
    result: 0,
    nodes: nodes
  };
  return resp;

nodes: definedInOnBeforeInstall

# --Events --
onInstall:
  - setJournaldLimit
  - installDatabase:
      user: ${globals.db_user}
      password: ${globals.db_pass}
